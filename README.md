# Нome_work_8

## Описание проекта
Это банковское приложение, которое:
+ Cкрывает номер карты и номер счета(функция `mask_account_card`);
+ Обрабатывающее дату и редактирующая ее в читаемый формат(функция `get_date`);
+ Сортирует список словарей по состоянию(функция `filter_by_state`);
+ Сортирует список словарей по дате(функция `sort_by_date`);
+ Фильтрует банковские операции по заданному типу валюты(функция `filter_by_currency`)
+ Описывает транзакции(функция `transaction_descriptions`)
+ Генерирует рандомный номер карты(функция `card_number_generator`)
+ Читает данные из json-файла(функция `financial_transaction_data_json`)
+ Возвращает из списка транзакций сумму в рублях, если операция была проведена в валюте евро или доллар,
то конвертирует в рубли (функция `currency_conversion`)
+ Читает файл в формате `CSV` и преобразовывает его в формат `JSON`(функция `read_csv_file`)
+ Читает файл в формате `EXCEL` и преобразовывает его в формат `JSON`(функция `read_excel_file`)

## Использование
Для запуска приложения необходимо:
1. Клонируйте репозиторий:

```
git clone https://github.com/IliaGirko/home_work_03.git
```
2. Установите виртуальное окружение:
```
poetry install
```
3. Дополните файл `.env.example` необходимыми данными и переименуйте в `.env`

## Приложение можно использовать по отдельности(в каждом файле отдельно) или целиком(из файла *main.py*)

4. Используйте приложение в файлах *widget.py*, *processing.py*, *generators.py*, *utils.py* и *external_api.py*

## Пример работы файла *widget.py*
### Пример для карты, функция `mask_account_card`:
+ Visa Platinum 7000792289606361  # входной аргумент
+ Visa Platinum 7000 79** **** 6361  # выход функции

### Пример для счета, функция `mask_account_card`:
+ Счет 73654108430135874305  # входной аргумент
+ Счет **4305  # выход функции

### Пример даты, функция `get_date`:
+ "2024-03-11T02:26:18.671407" # входной аргумент

+ "ДД.ММ.ГГГГ" ("11.03.2024") # выход функции

## Пример работы файла *processing.py*
### Пример даты, функция `filter_by_state`:
В переменную `input_data` можете внести свои данные для обработки по примеру:
```
[
 {'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'},
 {'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'},
 {'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'},
 {'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}
]
```
В вызове функции (`print(filter_by_state(input_data))`) - будет возвращено значение статуса по-умолчанию('EXECUTED'): 
```
[
{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, 
{'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}
] 
```

При указании в качестве второго аргумента в вызове функции статуса(`state ='CANCELED'`), будет произведена сортировка по этому значению:

```
[
{'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, 
{'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}
] 
```
### Пример даты, функция `sort_by_date`:
В переменную `input_data` можете внести свои данные для обработки по примеру:
```
[
 {'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'},
 {'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'},
 {'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'},
 {'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}
]
```
В вызове функции (`print(sort_by_date(input_data))`) - будет произведена сортировка по-умолчанию(по убыванию): 
```
[
{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}, 
{'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}, 
{'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, 
{'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}
] 
```
При указании в качестве второго аргумента в вызове функции направления сортировки(`direction = False`), будет произведена сортировка по возрастанию:

```
[
{'id': 939719570, 'state': 'EXECUTED', 'date': '2018-06-30T02:08:58.425572'}, 
{'id': 594226727, 'state': 'CANCELED', 'date': '2018-09-12T21:27:25.241689'}, 
{'id': 615064591, 'state': 'CANCELED', 'date': '2018-10-14T08:21:33.419441'}, 
{'id': 41428829, 'state': 'EXECUTED', 'date': '2019-07-03T18:35:29.512364'}
] 
```
## Пример работы файла *generators.py*
### Пример фильтрации банковских операций по заданному типу валюты, функция `filter_by_currency`:
1. Снимаем коментарии с этого блока кода:
```
# usd_transactions: list[Union[str | int]] = filter_by_currency(transactions, currency="USD")
# for i in range(2):
#     try:
#         print(next(usd_transactions))
#     except TypeError:
#         print("Не введена валюта для фильтрации")
#         break
#     except StopIteration:
#         print("Генератор исчерпан")
#         break
```
2. В качестве аргумента, в функцию filter_by_currency передаем список транзакций в формате: 
```
[
    {
        "id": 939719570,
        "state": "EXECUTED",
        "date": "2018-06-30T02:08:58.425572",
        "operationAmount": {"amount": "9824.07", "currency": {"name": "USD", "code": "USD"}},
        "description": "Перевод организации",
        "from": "Счет 75106830613657916952",
        "to": "Счет 11776614605963066702",
    }
]
```
и вид валюты, для фильтрации("USD"/"RUB"/"EUR"...)

### Пример вывода описания транзакции, функция `transaction_descriptions`:
1. Снимаем коментарии с этого блока кода:
```
# descriptions = transaction_descriptions(transactions)
# if len(transactions) != []:
#     for i in range(len(transactions)):
#         print(next(descriptions))
# else:
#     print("Список транзакций пуст")
```
2. В качестве аргумента, в функцию transaction_descriptions передаем список транзакций в формате: 
```
[
    {
        "id": 939719570,
        "state": "EXECUTED",
        "date": "2018-06-30T02:08:58.425572",
        "operationAmount": {"amount": "9824.07", "currency": {"name": "USD", "code": "USD"}},
        "description": "Перевод организации",
        "from": "Счет 75106830613657916952",
        "to": "Счет 11776614605963066702",
    }
]
```
3. В качестве вывода данной функции в этом примере будет строка: "Перевод организации"

### Пример генерации рандомного номера карты, функция `card_number_generator`:
1. Снимаем коментарии с этого блока кода:
```
# for card_number in card_number_generator(1, 5):
#     print(card_number)
```
2. В качестве аргумента, в функцию card_number_generator передаем число в формате: 
```
start = 1, stop = 5
```
3. В качестве вывода данной функции в этом примере будет строка: "0000 0000 0000 000n", где n - случайно 
сгенерированный номер

## Пример работы файла *utils.py*
### Пример фильтрации банковских операций по заданному типу валюты, функция `financial_transaction_data_json`:
1. Вызываем функцию `financial_transaction_data_json` с путем к файлу в качестве аргумента.
```
print(financial_transaction_data_json("../data/operations.json")) 
# при необходимости изменить название файла/директории или расположения файла, можете подставить свои данные.
```

## Пример работы файла *external_api.py*
### Пример функции, возвращающей сумму операции в рублях `currency_conversion`:
#### (Если валюта доллар или евро, то конвертирует в рубли)
1. Вызываем функцию `currency_conversion`. В качестве аргумента передаем список транзакций, в котором указано 
минимально необходимое количество ключей для поиска операции:
```
[
  {
    "date": "2019-08-26T10:50:58.294041",
    "operationAmount": {
      "amount": "31957.58",
      "currency": {
        "name": "руб.",
        "code": "RUB"
      }
    },
  }
]
```
## Пример работы файла *read_csv_file.py*
### Функция читает файл в формате сsv и возвращает json `read_csv_file`:
1. Для работы функции `read_csv_file`, необходимо ее вызвать с аргументом - путем к файлу в формате csv, пример:
```
read_csv_file("../transactions.csv")
```
передаваемое значение должно быть строкой.

## Пример работы файла *read_excel_file.py*
### Функция читает файл в формате сsv и возвращает json `read_excel_file`:
1. Для работы функции `read_excel_file`, необходимо ее вызвать с аргументом - путем к файлу в формате xlsx, пример:
```
read_excel_file("../transactions_excel.xlsx")
```
передаваемое значение должно быть строкой.

## Пример работы программы целиком (файл *main.py*)
1. Функция читает файл в формате на выбор: сsv, json или xlsx:
```
Привет! Добро пожаловать в программу работы 
с банковскими транзакциями. 
Выберите необходимый пункт меню:
1. Получить информацию о транзакциях из JSON-файла
2. Получить информацию о транзакциях из CSV-файла
3. Получить информацию о транзакциях из XLSX-файла
```
после ввода 1, 2 или 3 - программа сообщает о сделаном выборе:
```
Для обработки выбран CSV-файл. (либо JSON или XLSX)
```
и переходит к следующему шагу.
2. Фильтрует список операций по статусу EXECUTED, CANCELED или PENDING:
```
Введите статус, по которому необходимо выполнить фильтрацию.
Доступные для фильтровки статусы: EXECUTED, CANCELED, PENDING
```
после корректного ввода статуса программа переходит к следующему :
```
# executed (EXEcuTed/EXECUTED)
```
3. Далее программа запросит необходимость сортировки данных по дате, в случае отрицательного ответа(*НЕТ*)
программа переходит к следующему шагу. В случае полжительного ответа программа запросит направление сортировки
(по возрастанию или по убыванию)
```
Отсортировать операции по дате? Да/Нет
# нет
```
```
Отсортировать операции по дате? Да/Нет
# да
Отсортировать по возрастанию или по убыванию?
# по убыванию
```
4. В следующем шаге программа запрашивает валлюту для вывода данных(*RUB* или все имеющиеся)
```
Выводить только рублевые тразакции? Да/Нет
# нет
```
5. Последним шагом - программа запрашивает необходимость фильтрации данных по одному или нескольким "ключевым словам"
```
Отфильтровать список транзакций по определенному слову в описании? Да/Нет
# да
Введите слово для поиска: перевод #Пример ввода
```
6. После всех корректно пройденных шагов: программа заканчивает работу с одним из следующих результатов:
1) В случае если не было найдено операций удовлетворяющих критерии поиска:
```

```
2) При положительном поиске программа вывет следуюшщие сообщения:
```
Распечатываю итоговый список транзакций...
Всего банковских операций в выборке: 555 #Пример вывода
```
после чего следует перечисление операций либо в том порядке который был изначально, либо в том что был выбран
пользователем, пример:
```
12.11.2023 Перевод с карты на карту
Visa 2336 86** **** 9932 -> American Express 2266 39** **** 5773
Сумма: 34316 EUR

10.11.2023 Перевод со счета на счет
Счет **0297 -> Счет **9881
Сумма: 23211 PLN

10.11.2023 Перевод организации
Discover 0310 55** **** 0428 -> Счет **3337
Сумма: 17606 EUR
```
## Логирование
+ На файлы *utils.py* и *masks.py* написаны логи. Размещаются в директории *data* в файлах с соответсвующими именами.

## Функция-декоратор
В файле decorators.py реализов декоратор который автоматически регистрирует детали выполнения функций, 
такие как время вызова, имя функции, передаваемые аргументы, результат выполнения и информацию об ошибках

## Code coverage
Code coverage достигает 96%

## Лицензии
Проект распространяеется под [лицензией MIT](https://github.com/git/git-scm.com/blob/main/MIT-LICENSE.txt)
